<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>
	<input type="text" id="search_str" name="search_str"><button onclick="fetch_yard_data()">Search Junkyards</button>
	<div id="results"></div>
	<script type="text/javascript">
		function fetch_yard_data(){
			let search_str = document.querySelector('#search_str').value
			fetch('http://localhost:5009/search',{
				'body': JSON.stringify({'search_str': search_str}),
				'method': "POST",
				'headers':{"Content-Type": "application/json"}
			}).then(response => response.json()).then(data => {
				display_data(data)
			})
		}
		function display_data(data){
			console.log('Displaying data:', data)
			results_div = document.querySelector('#results');
			if(results_div.children)
				results_div.innerHTML = ''
			//Loop through each yard
			for (var i=0; i<data.length;i++){
				yard_data = data[i];
				results = yard_data['results'];
				console.log(results)
				headers = Object.keys(results[0]);
				table = document.createElement("table");
				h1 = document.createElement("h1");
				h4 = document.createElement("h4");
				th = createTh(headers);
				h4.innerText = yard_data['summary'];
				h1.innerText = yard_data['name'];
				results_div.appendChild(h1);
				results_div.appendChild(h4);
				table.appendChild(th);
				// Loop through each result from the yard
				for(var x = 0; x<results.length; x++){
					let tr = createResultRow(results[x]);
					table.appendChild(tr);
				}
				results_div.appendChild(table);
			}

		}
		function createTh(headers){
			tr = document.createElement("tr");
			for(var w=0; w<headers.length; w++){
				th = document.createElement('th');
				th.innerText = headers[w];
				tr.appendChild(th)
			}
			return tr
		}
		function createResultRow(result){
			tr = document.createElement("tr");
			result_cols = Object.keys(result);
			console.log(result_cols);
			for(var w=0; w<result_cols.length; w++){
				td = document.createElement('td');
				td.innerText = result[result_cols[w]];
				tr.appendChild(td)
			}
			return tr
		}
		
	</script>
</body>
</html>